<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctor Profile</title>
  {% load static %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script>const csrfToken = "{{ csrf_token }}";</script>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-success shadow-sm">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">üë®‚Äç‚öïÔ∏è Doctor Profile</span>
    <a href="{% url 'accounts:doctor_dashboard' %}" class="btn btn-outline-light btn-sm">‚¨Ö Back</a>
  </div>
</nav>

<div class="container py-5">
  <div class="card shadow-lg border-0">
    <div class="card-body">
      <h3 id="doc-name" class="fw-bold text-success mb-3">{{ doctor.user.full_name }}</h3>
      <p class="mb-1"><strong>Email:</strong> <span id="doc-email">{{ doctor.user.email }}</span></p>
      <p class="mb-1"><strong>Specialty:</strong> <span id="doc-specialty">{{ doctor.specialty }}</span></p>
      <p class="mb-1"><strong>Clinic Location:</strong> <span id="doc-location">{{ doctor.clinic_location }}</span></p>
      <p class="mb-3"><strong>Consultation Fee:</strong> $<span id="doc-fee">{{ doctor.consultation_fee }}</span></p>

      <button class="btn btn-warning mb-3" onclick="toggleForm()">‚úèÔ∏è Edit Profile</button>

      <form id="editForm" class="border rounded p-3 bg-light" style="display:none;">
        {% csrf_token %}
        <div class="mb-3">
          <label class="form-label fw-semibold">Specialty</label>
          <input type="text" name="specialty" class="form-control" value="{{ doctor.specialty }}">
        </div>
        <div class="mb-3">
          <label class="form-label fw-semibold">Clinic Location</label>
          <input type="text" name="clinic_location" class="form-control" value="{{ doctor.clinic_location }}">
        </div>
        <div class="mb-3">
          <label class="form-label fw-semibold">Consultation Fee ($)</label>
          <input type="number" step="0.01" min="0" name="consultation_fee" class="form-control" value="{{ doctor.consultation_fee }}">
        </div>
        <button type="submit" class="btn btn-success w-100">üíæ Save Changes</button>
      </form>

      <div id="msg" class="mt-3"></div>
    </div>
  </div>
</div>

<script>
  function toggleForm() {
    const form = document.getElementById("editForm");
    form.style.display = form.style.display === "none" ? "block" : "none";
  }

  document.getElementById("editForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);

    try {
      const response = await fetch("{% url 'accounts:update_doctor_profile' %}", {
        method: "POST",
        headers: { "X-CSRFToken": csrfToken, "X-Requested-With": "XMLHttpRequest" },
        body: formData
      });

      const data = await response.json();
      const msgDiv = document.getElementById("msg");

      if (data.success) {
        document.getElementById("doc-specialty").innerText = formData.get("specialty");
        document.getElementById("doc-location").innerText = formData.get("clinic_location");
        document.getElementById("doc-fee").innerText = formData.get("consultation_fee");

        msgDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
        form.style.display = "none";
      } else {
        msgDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
      }
    } catch (err) {
      document.getElementById("msg").innerHTML = `<div class="alert alert-danger">‚ö† Error saving changes.</div>`;
    }
  });
</script>

</body>
</html>